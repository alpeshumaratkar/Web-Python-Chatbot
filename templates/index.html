<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Python Chatbot</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<div class="chat-container" id="chatContainer">
    <div class="chat-header">
        ðŸ¤– Python Chatbot
        <button class="toggle-btn" onclick="toggleDarkMode()">ðŸŒ™</button>
    </div>

    <div id="chat" class="chat-body"></div>

    <div id="typing" class="typing">Bot is typing...</div>

    <div class="chat-input">
        <input type="text" id="userInput" placeholder="Type your message..." />
        <button onclick="sendMessage()">Send</button>
    </div>
</div>

<script>
async function sendMessage() {
    const input = document.getElementById("userInput");
    const message = input.value.trim();
    if (message === "") return;

    input.value = "";
    const chat = document.getElementById("chat");

    const time = new Date().toLocaleTimeString([], {
        hour: '2-digit',
        minute: '2-digit'
    });

    // Show user message
    chat.innerHTML += `
        <div class="msg user-msg">
            <span>ðŸ‘¤ ${message}</span>
            <div class="time">${time}</div>
        </div>
    `;

    const typing = document.getElementById("typing");
    typing.style.display = "block";

    try {
        const response = await fetch("/chat", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ message: message })
        });

        if (!response.ok) {
            throw new Error("Server returned error");
        }

        const data = await response.json();

        typing.style.display = "none";

        // Show bot reply
        chat.innerHTML += `
            <div class="msg bot-msg">
                <span>ðŸ¤– ${data.reply}</span>
                <div class="time">${time}</div>
            </div>
        `;

        chat.scrollTop = chat.scrollHeight;

    } catch (error) {
        typing.style.display = "none";

        chat.innerHTML += `
            <div class="msg bot-msg">
                <span>ðŸ¤– Server not responding. Please try again.</span>
            </div>
        `;

        console.error(error);
    }
}

function toggleDarkMode() {
    document.getElementById("chatContainer").classList.toggle("dark");
}

document.getElementById("userInput")
    .addEventListener("keypress", function(e) {
        if (e.key === "Enter") {
            sendMessage();
        }
    });
</script>

</body>
</html>
